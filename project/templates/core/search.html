{% extends 'base.html' %}

<!-- start block content  -->
{% block content %}

<div class="row align-items-center">
    <div class="container-inner">

        <!-- heading text  -->
        <div>
            <h2 class="heading-text">Search post</h2>
            <p class="reg-size light-gray-text quat-sans-reg">Find blog posts by title, content, or category.</p>
        </div>


        <!-- form  -->
        <div class="mt-4 align-items-center mb-4 pb-4 with-divider">
            <form method="POST">
                {{ form.hidden_tag() }}

                <div class="mb-2">
                    {{ form.search.label(class="form-label form-lab") }} {{ form.search(class="form-control form-txt", placeholder="Search..", value=search_query or '') }}
                </div>

                <!-- submit button -->
                <div class="d-flex justify-content-end">
                    {{ form.submit(class="btn btn-outline-dark mt-2") }}
                </div>
            </form>
        </div>


        <!-- results  -->
        {% if search_query %}

        <!-- numbers of results  -->
        {% if results.items %}
        <div>
            <span class="quat-sans-reg reg-size light-gray-text mb-1">{{ results.total }} result{{ 's' if results.total != 1 }} found for </span>
            <span class="quat-sans-reg reg-size dark-gray-text">"{{ search_query }}"</span>
        </div>

        <!-- blogs  -->
        {% for post in results.items %}
        <div class="mt-4 with-divider" style="padding-bottom: 20px;">
            <a href="{{ url_for('blog_posts.blog_post', blog_post_id=post.id) }}" class="image-container">
                <img class="rounded-0" src="{{ url_for('static', filename='blog_cover_images/' + post.cover_image) }}" alt="blog image">
            </a>

            <div class="px-0 pt-3">

                <!-- category  -->
                <div class=""><a href="{{ url_for('blog_posts.category_posts', category_slug=post.category) }}" class="category-tag quat-sans-reg reg-size">{{ post.category|replace('_', ' ')|title }}</a></div>

                <!-- title -->
                <div class="mt-2">
                    <a href="{{ url_for('blog_posts.blog_post', blog_post_id=post.id) }}" class="heading-text" style="text-decoration: none;">{{ post.title }}</a>
                </div>


                <!-- profile image, name, date -->
                <div class="d-flex align-items-center gap-2 mt-3">

                    <a href="{{ url_for('users.user_posts', username=post.author.username) }}">
                        <img src="{{ url_for('static', filename='profile_pics/' + post.author.profile_image) }}" alt="Profile Image" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover;">
                    </a>


                    <div class="d-flex align-items-center gap-1">
                        <a class="quat-sans-reg reg-size dark-gray-text" style="text-decoration: underline;" href="{{ url_for('users.user_posts', username=post.author.username) }}">{{ post.author.username }}</a>
                    </div>

                    <div style="width: 1px; height: 16px; background-color: #CBD0D0;"></div>

                    <div class="d-flex align-items-center gap-1">
                        <span class="quat-sans-reg reg-size light-gray-text">{{ post.date.strftime('%d %B %Y') }}</span>
                    </div>

                </div>

                <!-- body text  -->
                <p class="para-text truncate-text pt-3">{{ post.text }}</p>
            </div>
        </div>
        {% endfor %}


        <!-- pagination  -->
        <div class="mt-4">
            <nav aria-label="Search pagination">
                <ul class="pagination custom-pagination">
                    {% if results.has_prev %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('core.search', q=search_query, page=results.prev_num) }}">Previous</a></li>
                    {% endif %} {% for page_num in results.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %} {% if page_num %}
                    <li class="page-item {% if page_num == results.page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('core.search', q=search_query, page=page_num) }}">{{ page_num }}</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                    {% endif %} {% endfor %} {% if results.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('core.search', q=search_query, page=results.next_num) }}">Next</a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>

        {% else %}
        <span class="quat-sans-reg reg-size light-gray-text">No results found for </span>
        <span class="quat-sans-reg reg-size dark-gray-text">"{{ search_query }}"</span>
        <!--  -->
        {% endif %} {% endif %}

    </div>
</div>


<!-- end of block content  -->
{% endblock %}